<div class"app-header">
    
    <form class="search-bar" onsubmit="submitSearchForm('search-home');">
        <i class="icon ion-search"></i>
        <input autocorrect="off" autocapitalize="off" id="search-home" k="ខ្ញុំកំពុងស្វែងរក ..." onkeyup="searchKeyword('home')" onclick="searchClick()" placeholder="I'm shopping for ..." class="search">
    
        <span ontap="cancelClick()" class="cancel" k="បិទ">Cancel</span>
    </form>
    <ul class="search-form">
        
    </ul>
</div>
<ion-view hide-nav-bar="true" class="header-view">
    <div class="ion-content" id="home" on-scroll-complete="onComplete()">
        <input id="data" type="hidden">
        <input id="start" type="hidden" value="0">
        <input id="all" type="hidden" value="0">
    
        <div class="home">            
            <div class="map_canvas" style="width:100%;height:400px">
            
            </div>
            <script>
                $(window).geocomplete({
                    map: ".map_canvas",
                    mapOptions: {
                        draggable: false,
                        zoom: 16
                    },                
                    location: [52.4078567, 16.92718339999999]                        
                });
                </script>
        <script>/*
            <ion-slide-box on-slide-changed="slideHasChanged($index)" auto-play="true" does-continue="true" class="home-slider">
                <ion-slide onclick="window.location.href='#tab/iframe'">
                    <img ng-src="img/slide-1.jpg">
                </ion-slide>
                <ion-slide>
                    <img ng-src="img/slide-2.jpg">
                </ion-slide>
                <ion-slide>
                    <img ng-src="img/slide-3.jpg">
                </ion-slide>
            </ion-slide-box>
            */</script>
            <div class="home-slider owl-carousel owl-theme">
                
            </div>
            <script> 
                $.post(URL+'app/home_slider.php', {}, function(data){
                    var a = JSON.parse(data);
                    var str = '';
                    
                    for (var i = 0; i < a.length; i++){
                        str += '<img src="'+a[i]['img_src']+'">';
                    }
                    $('.home-slider').html(str);
                    $('.home-slider').owlCarousel({
                        loop:true,
                        margin:10,
                        autoplay:true,
                        autoplayTimeout:5000,
                        autoplayHoverPause:true,
                        responsive:{
                            0:{
                                items:1
                            }
                        }
                    });
                });
                
                
            </script>
            
            <ul class="cate owl-carousel owl-theme" id="cate">
                
            </ul>
            <ul class="cate owl-carousel owl-theme" id="cate-2">
                
            </ul>
            
            
            
            <div class="hr"></div>
            <div class="wrap">
                <div class="new-arrival">
                    <h3 k="ទំនិញមកដល់ថ្មី">New Arrival</h3>
                </div>                
                <ul id="new_arrival">
                    
                <ul>
                
            </div>
        </div>
        
    </div>
</ion-view>


<script>    
    $('#home').scroll(function() {
        var start = parseInt($('#start').val(), 10);
        var all = parseInt($('#all').val(), 10);
       if(($('#new_arrival').height() - $('#home').scrollTop()) < 100 && (start < all)) {
           loadMore();
       }
    });
    //window.location.href="#tab/product2/";
   
    
    var size = $(window).width();        
    $.post(URL+'app/new_arrival.php',{size:size},function(data){
        $('#data').val(data);  
        $('#all').val(JSON.parse(data).length);
        loadMore();
    });
    
    function loadMore(){        
                
        var start = parseInt($('#start').val(), 10);
        var all = parseInt($('#all').val(), 10);
        
        var end = start + 12;        
        if (end >= all) end = all;
        
        if (start < end) {
            var size = $(window).width();
            var a_wh = (size-30)/2;        
            var data = $('#data').val();                
            var arr = JSON.parse(data);   
            
            for (var i = start; i < end; i++){            
                var ad = arr[i];            
                var ad_id = ad['ad_id'];  
                
                var str = '<ion-item onclick="loadProduct(\''+ad_id+'\', \'home\');" class="ad-item">';
                    str += '<div class="b" style="width:'+a_wh+'px;height:'+a_wh+'px">';
                        str += '<img style="width:'+ad['width']+'; height:'+ad['height']+'; margin-'+ad['margin']+':'+ad['margin-px']+'px" src="'+URL+'ads/'+ad['ad_id']+'/1_m.jpg">';
                    str += '</div>';
                    str += '<div class="a">';
                        str += '<span class="aa">'+ad['price']+'</span>';
                        str += '<span class="ab"><span>'+ad['n_order']+'</span> <span k="កម្មង់">order</span></span>';
                    str += '</div>';
                str += '</ion-item>';
                
                $('#new_arrival').append(str);
            }  
            la();                           
            $('#start').val(end);
        }
    }

    
    

    //getLocation();
    
    $.post(URL+'app/category.php',{},function(data){
        var cate = JSON.parse(data);
        var str = '';
        for (var i = 0; i < 4; i++){
            var c = cate[i];            
            str += '<li>';
                str += '<div>';
                    str += '<span class="fa '+c['fa']+'"></span>';
                str += '</div>';
                str += '<div k="'+c['name_kh']+'">';
                    str += c['name_en'];
                str += '</div>';
            str += '</li>';            
        }
        $('#cate').html(str);
        var str = '';
        for (var i = 4; i < 8; i++){
            var c = cate[i];            
            str += '<li>';
                str += '<div>';
                    str += '<span class="fa '+c['fa']+'"></span>';
                str += '</div>';
                str += '<div k="'+c['name_kh']+'">';
                    str += c['name_en'];
                str += '</div>';
            str += '</li>';            
        }
        $('#cate-2').html(str);
        
        /*
        $('#cate').owlCarousel({
                margin:10,                
                responsive:{
                    0:{
                        items:5
                    }
                }
            });
            */
        la();
            
    });
    la();

</script>